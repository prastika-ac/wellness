<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Checkout</title>
<style>
	table {
		border-collapse: collapse;
		width: 100%;
		margin-bottom: 20px;
	}

	th,
	td {
		border: 1px solid #dddddd;
		text-align: left;
		padding: 8px;
	}

	th {
		background-color: #f2f2f2;
	}

	#checkoutButton {
		padding: 10px 20px;
		background-color: #4CAF50;
		color: white;
		border: none;
		border-radius: 5px;
		cursor: pointer;
	}

	.input-field {
		width: 100%;
		padding: 8px;
		box-sizing: border-box;
	}
</style>
</head>

<body>
	<h1>Checkout</h1>
	<h2>Selected Products Table</h2>
	<table>
		<thead>
			<tr>
				<th>Product</th>
				<th>Quantity</th>
				<th>Unit Price</th>
				<th>Total Price</th>
			</tr>

		</thead>
		<tbody id="checkoutTableBody">
		</tbody>
		<!-- Add the following row at the end of the table -->


		<tfoot>
			<tr>
				<td colspan="3" style="text-align: right;">Overall Total :</td>
				<td id="overallTotalCell"></td>
			</tr>
		</tfoot>

	</table>

	<form
		action="https://script.google.com/macros/s/AKfycbyPzl_vCLQ-w5i16fpUaxtr2FUioxBolqSyxW9k0ydYh7-FhjnZkRSbm-OiyIC2W-80lA/exec"
		method="POST" name="orderForm" onsubmit="return validateAndSubmitForm()">


		<p><input type="text" name="fullName" placeholder="Name">
		</p>
		<p><input type="email" name="email" placeholder="Email">
		</p>
		<p><input type="text" name="address" placeholder="Address">
		</p>
		<p><input type="text" name="phone" placeholder="Phone No">
		<p><input type="text" id="overallTotalInput" name="overallTotal" placeholder="Overall Total" readonly></p>

		<p><input id="notifmail" style="display: none;" type="text" name="notifmail" placeholder="notifmail"
				value="Received"></p>
		</p>
		<div id="productFields"></div>

		<label>
			<textarea style="resize: vertical; height: 100px; font-weight: 100;" class="cInpt cMsg" name="bill"
				id="message bill" placeholder="Message" rows="5"></textarea>
		</label>

		<p><input style="display: none;" type="text" name="MailStatus" placeholder="Pending" value="Pending"></p>
		<p><input style="display: none;" type="text" name="OrderStatus" placeholder="Received" value="Received"></p>
		<p><input style="display: none;" type="text" name="Time" id="dateTimeInput" placeholder="Date and Time"></p>
		<style>
			.delivery {
				font-size: 15px;
				font-weight: 600;
				font-family: "Poppins", sans-serif;
			}

			@media only screen and (max-width: 768px) {
				.delivery {
					font-size: 13.5px;
					font-weight: 600;
					font-family: "Poppins", sans-serif;
				}
			}
		</style>

		<style>
			/* Checkbox styles */
			input[type="checkbox"] {
				font-size: 15px;
				font-weight: 600;
				font-family: "Poppins", sans-serif;
				margin-right: 5px;
				/* Add some spacing between the checkbox and the label */
			}
		</style>

		<label class="delivery" for="deliveryOption">Do you want home delivery?</label>
		<div class="checkbox-wrapper-55 delivery">
			<label class="rocker rocker-small">
				<input type="checkbox" id="deliveryOption" name="HomeDelivery" value="yes"
					onclick="handleDeliveryOption(), check()">
				<span class="switch-left">Yes</span>
				<span class="switch-right">No</span>
			</label>
			<p class="delivery" id="pickupMessage" style="margin-bottom: 10px !important; color: red;">
				*Visit store to Pickup your Product & Grab 10% discount*
			</p>

		</div>

		<script>
			// Call showPickupMessage initially to display the message by default
			showPickupMessage(true);

			function check() {
				var deliveryCheckbox = document.getElementById("deliveryOption");
				showPickupMessage(!deliveryCheckbox.checked);
			}

			function showPickupMessage(show) {
				var pickupMessage = document.getElementById("pickupMessage");
				pickupMessage.style.display = show ? "block" : "none";
			}
		</script>
		<script>
			function handleDeliveryOption() {
				var deliveryCheckbox = document.getElementById("deliveryOption");
				var overallTotalInput = document.getElementById("overallTotalInput");
				var uploadSection = document.getElementById("uploadSection");

				var overallTotalPrice = parseFloat(overallTotalInput.value.replace("Rs. ", ""));

				if (overallTotalPrice >= 500) {
					deliveryCheckbox.disabled = false;
				} else {
					deliveryCheckbox.disabled = true;
					deliveryCheckbox.checked = false;
					alert("Home delivery is only available for orders above Rs. 500!");
				}

				if (deliveryCheckbox.checked) {
					uploadSection.style.display = "block"; // Show the upload section if home delivery is selected
				} else {
					uploadSection.style.display = "none"; // Hide the upload section if home delivery is not selected
				}
			}

		</script>
		<script>
			function showPickupMessage(show) {
				var pickupMessage = document.getElementById("pickupMessage");
				var deliveryCheckbox = document.getElementById("deliveryOption");

				if (!deliveryCheckbox.checked && show) {
					pickupMessage.innerText = "*Visit store to Pickup your Product & Grab 10% discount*";
					pickupMessage.style.display = "block";
				} else {
					pickupMessage.style.display = "none";
				}
			}
		</script>

		<script>
			// Function to get current date, day, and time in 12-hour format
			function getCurrentDateTime12Hour() {
				var currentDate = new Date();
				var days = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
				var day = days[currentDate.getDay()];
				var hours = currentDate.getHours() % 12 || 12; // Convert to 12-hour format
				var minutes = currentDate.getMinutes();
				var ampm = hours >= 12 ? 'PM' : 'AM';
				var formattedDateTime = currentDate.toLocaleDateString() + ' ' + day + ', ' + hours + ':' + (minutes < 10 ? '0' : '') + minutes + ' ' + ampm;
				return formattedDateTime;
			}

			// Set the value of the input field with the formatted date, day, and time
			document.getElementById('dateTimeInput').value = getCurrentDateTime12Hour();
		</script>

		<style>
			.home {
				margin-left: 0px;
				margin-right: 0px;
			}

			/* Style for the select dropdown */
			.area {
				padding: 8px;
				font-size: 14px;
				border: 1px solid #ccc;
				border-radius: 4px;
				width: 200px;
				/* Adjust the width as needed */
				pointer-events: all;
			}

			/* Style for the options within the dropdown */
			.area option {
				font-size: 14px;
			}
		</style>

		<div class="delivery home" id="uploadSection" style="display: none;">


			<style>
				.area-container {
					display: flex;
					align-items: center;
					margin-bottom: 10px;
				}

				.area-container label {
					margin-right: 10px;
				}
			</style>


			<label for="location">Location:</label>
			<select id="location" name="location" onchange="showSubDropdown()">
				<option value="" disabled selected>Select a location</option>
				<option value="Sunsari">Sunsari</option>
				<option value="Morang">Morang</option>
				<option value="Jhapa">Jhapa</option>
			</select>

			<div class="sub-dropdown-container" id="subDropdownContainer" style="display:none;">
				<div class="area-container">
					<label for="subLocation">Area:</label>
					<div class="custom-dropdown">
						<select id="subLocation" name="subLocation" class="area" onchange="showLandmarkInput()">
							<option value="" disabled selected>Select an area</option>
						</select>
					</div>
				</div>
			</div>

			<div id="shippingFeeMessage" style="display:none;"></div>
			<div id="landmarkInput" style="display:none;">
				<label for="placeName">Your Place Name:</label>
				<input type="text" id="placeName" name="placeName" placeholder="Your place name">
			</div>

			<script>
				function showSubDropdown() {
					var locationDropdown = document.getElementById("location");
					var subDropdownContainer = document.getElementById("subDropdownContainer");
					var shippingFeeMessage = document.getElementById("shippingFeeMessage");

					// Clear previous options
					var subLocationDropdown = document.getElementById("subLocation");
					subLocationDropdown.innerHTML = "";
					var defaultOption = new Option("Select an area", "");
					defaultOption.disabled = true;
					defaultOption.selected = true;
					subLocationDropdown.add(defaultOption);

					// Create and populate sub-dropdown based on selected location
					if (locationDropdown.value === "Sunsari") {
						addOptionsToSubDropdown(["Itahari Area", "Other Area"]);
					} else if (locationDropdown.value === "Morang") {
						addOptionsToSubDropdown(["Urlabari Area", "Other Area"]);
					} else if (locationDropdown.value === "Jhapa") {
						addOptionsToSubDropdown(["Damak Area", "Birtamode Area", "Other Area"]);
					}

					// Hide shipping fee message and landmark input initially
					shippingFeeMessage.style.display = "none";
					landmarkInput.style.display = "none";

					// Show the container after adding options
					subDropdownContainer.style.display = "block";
				}

				function addOptionsToSubDropdown(options) {
					var subLocationDropdown = document.getElementById("subLocation");
					options.forEach(function (option) {
						var optionElement = new Option(option, option);
						subLocationDropdown.add(optionElement);
					});
				}

			</script>

			<script>
				function showLandmarkInput() {
					var subLocationDropdown = document.getElementById("subLocation");
					var selectedOption = subLocationDropdown.options[subLocationDropdown.selectedIndex].value;
					var shippingFeeMessage = document.getElementById("shippingFeeMessage");
					var landmarkInput = document.getElementById("landmarkInput");

					if (selectedOption === "Itahari Area" || selectedOption === "Urlabari Area" || selectedOption === "Damak Area" || selectedOption === "Birtamode Area") {
						// Hide the input field for these areas
						landmarkInput.style.display = "none";
					} else if (selectedOption === "Other Area") {
						// Show the input field for other areas
						landmarkInput.style.display = "block";
					} else {
						// Hide the input field for all other options
						landmarkInput.style.display = "none";
					}

					// Update shipping fee message
					updateShippingFeeMessage(selectedOption);
				}

				function updateShippingFeeMessage(selectedOption) {
					var shippingFeeMessage = document.getElementById("shippingFeeMessage");

					if (selectedOption === "Itahari Area" || selectedOption === "Urlabari Area" || selectedOption === "Damak Area" || selectedOption === "Birtamode Area") {
						shippingFeeMessage.innerHTML = "<span style='color:red;'>*Shipping fee is free for home delivery in " + selectedOption + ".*</span>";
						shippingFeeMessage.style.display = "block";
					} else if (selectedOption === "Other Area") {
						shippingFeeMessage.innerHTML = "<span style='color:red;'>*Rs. 99 will be charged for home delivery in your area.*</span>";
						shippingFeeMessage.style.display = "block";
					} else {
						shippingFeeMessage.style.display = "none";
					}
				}
			</script>


			<div id="subDropdownContainer" style="display:none;"></div>

			<p><input type="text" name="landMark" id="landMark"
					placeholder="Landmark *E.g. Tara Bhattrai house, Infront of Sahara Bank*"></p>
		</div>

		<style>
			/* Add your desired styles here */
			.medium-image {
				width: 50%;
				/* Adjust the width as needed */
				height: auto;
				justify-content: left;
				/* Center the image horizontally */
			}

			@media (max-width: 768px) {
				.medium-image {
					width: 100%;
					/* Make the image full-width on screens up to 768px */
				}
			}
		</style>

		<button type="submit" name="submit" class="place-order cBtn button" id="orderbtn">Place Order</button>

		<style>
			.place-order:hover {
				background-color: #051922 !important;
			}

			.place-order {
				cursor: pointer;
			}

			.qua:hover {
				background-color: #051922 !important;
				color: white;
			}
		</style>

	</form>


	<script>


		window.onload = function () {
			displaySelectedProducts();
			calculateOverallTotal();
		};


		function calculateOverallTotal() {
            let totalPrices = Array.from(document.querySelectorAll("#checkoutTableBody tr td:nth-child(4)")).map(td => parseFloat(td.textContent.replace("Rs.", "")));
            let overallTotal = totalPrices.reduce((total, price) => total + price, 0);
            document.getElementById("overallTotalCell").textContent = "Rs. " + overallTotal.toFixed(2);
            document.getElementById("overallTotalInput").value = overallTotal.toFixed(2);
        }



		function displaySelectedProducts() {
			let selectedProducts = JSON.parse(sessionStorage.getItem("selectedProducts") || "[]");
			let checkoutTableBody = document.getElementById("checkoutTableBody");

			selectedProducts.forEach(function (product, index) {
				// Display in table
				let row = checkoutTableBody.insertRow();
				let productNameCell = row.insertCell(0);
				let quantityCell = row.insertCell(1);
				let unitPriceCell = row.insertCell(2);
				let totalPriceCell = row.insertCell(3);

				productNameCell.innerHTML = product.productName;
				quantityCell.innerHTML = product.quantity;
				unitPriceCell.innerHTML = "Rs. " + product.unitPrice;
				totalPriceCell.innerHTML = "Rs. " + product.totalPrice;

				// Fill form fields
				let productFieldsDiv = document.getElementById("productFields");
				let productNameInput = document.createElement("input");
				productNameInput.setAttribute("type", "text");
				productNameInput.setAttribute("name", "productName_" + index);
				productNameInput.setAttribute("value", product.productName);
				productNameInput.setAttribute("class", "input-field");
				productFieldsDiv.appendChild(productNameInput);

				let productQuantityInput = document.createElement("input");
				productQuantityInput.setAttribute("type", "text");
				productQuantityInput.setAttribute("name", "productQuantity_" + index);
				productQuantityInput.setAttribute("value", product.quantity);
				productQuantityInput.setAttribute("class", "input-field");
				productFieldsDiv.appendChild(productQuantityInput);

				let perProductPriceInput = document.createElement("input");
				perProductPriceInput.setAttribute("type", "text");
				perProductPriceInput.setAttribute("name", "perProductPrice_" + index);
				perProductPriceInput.setAttribute("value", product.unitPrice);
				perProductPriceInput.setAttribute("class", "input-field");
				productFieldsDiv.appendChild(perProductPriceInput);

				let totalPriceInput = document.createElement("input");
				totalPriceInput.setAttribute("type", "text");
				totalPriceInput.setAttribute("name", "totalPrice_" + index);
				totalPriceInput.setAttribute("value", product.totalPrice);
				totalPriceInput.setAttribute("class", "input-field");
				productFieldsDiv.appendChild(totalPriceInput);
			});
		}



		function validateAndSubmitForm() {
			var fullName = document.forms["orderForm"]["fullName"].value.trim();
			var email = document.forms["orderForm"]["email"].value.trim();
			var phone = document.forms["orderForm"]["phone"].value.trim();
			var address = document.forms["orderForm"]["address"].value.trim();
			var homeDelivery = document.getElementById("deliveryOption").checked;
			var location = document.getElementById("location").value.trim();
			var subLocation = document.getElementById("subLocation").value.trim();
			var landmark = document.getElementById("landMark").value.trim();
			var placeName = document.getElementById("placeName").value.trim();


			// Validate required fields
			if (fullName === "" || email === "" || phone === "" || address === "") {
				alert("Please fill in all required fields!");
				return false;
			}

			// Validate email format
			var emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
			if (!emailRegex.test(email)) {
				alert("Please enter a valid email address!");
				return false;
			}

			// Validate phone number format (minimum 10 digits, optional leading +)
			var phoneRegex = /^\+?\d{10,}$/;
			if (!phoneRegex.test(phone)) {
				alert("Please enter a valid phone number!");
				return false;
			}

			// Validate if home delivery is selected
			if (homeDelivery) {
				if (location === "") {
					alert("Please select your location!");
					return false;
				}
				if (subLocation === "") {
					alert("Please select your area!");
					return false;
				}
				if ((placeName === "")) {
					alert("Please provide your place name for home delivery!");
					return false;
				}
				if (landmark === "") {
					alert("Please provide a landmark for home delivery!");
					return false;
				}
			}

			// Validation passed
			return true;
		}


	</script>


</body>

</html>